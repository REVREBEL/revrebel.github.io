import { useThemeUI, jsx, get } from 'theme-ui';
import Color from 'color';

const useTheme = () => useThemeUI().theme;

function _extends() {
  _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

const Card = props => jsx("div", _extends({}, props, {
  sx: {
    variant: 'styles.Card'
  }
}));

const TypeStyle = ({
  fontSize = 5,
  fontFamily = 'body',
  lineHeight = 'body',
  fontWeight = 'body',
  children = 'Aa',
  truncate = true,
  ...props
}) => {
  return jsx(Card, _extends({}, props, {
    children: children,
    sx: {
      fontFamily,
      fontSize,
      lineHeight,
      fontWeight,
      ...(truncate ? {
        overflow: 'hidden',
        textOverflow: 'ellipsis',
        whiteSpace: 'nowrap'
      } : {})
    }
  }));
};

const getValue = fontSize => typeof fontSize === 'number' ? `${fontSize}px` : fontSize;

const TypeScale = ({
  reverse = true,
  ...props
}) => {
  const theme = useTheme() || {};
  const fontSizeEntries = reverse ? Object.entries(theme.fontSizes || []).reverse() : Object.entries(theme.fontSizes || []);
  return jsx("div", {
    sx: {
      display: 'flex',
      flexWrap: 'wrap',
      alignItems: 'baseline'
    }
  }, fontSizeEntries.map(([key, val]) => {
    if (!val || typeof val === 'object') {
      // TODO: `theme.fontSizes` can be a deeply nested object.
      // We should either update the types or recursively render here.
      return null;
    }

    return jsx(TypeStyle, _extends({
      key: key,
      fontSize: key,
      sx: {
        mr: 3
      },
      children: getValue(val)
    }, props));
  }));
};

const HeadingStyle = props => jsx(TypeStyle, _extends({
  fontFamily: "heading",
  fontWeight: "heading",
  lineHeight: "heading"
}, props));

const FontFamily = ({
  name
}) => {
  const {
    fonts
  } = useTheme();
  return get(fonts, name);
};

const toHex = raw => {
  try {
    return Color(raw).hex();
  } catch (e) {
    return;
  }
};

const ColorSwatch = ({
  color,
  name,
  size = 128,
  label = true,
  ...props
}) => {
  const {
    colors
  } = useTheme();
  const value = get(colors, color);
  return jsx("div", _extends({}, props, {
    title: `${toHex(value)}`
  }), jsx("div", {
    sx: {
      width: size,
      height: size,
      bg: color
    }
  }), label && jsx("div", {
    sx: {
      py: 2
    }
  }, name || color));
};

const join = (...args) => args.filter(Boolean).join('.');

const ColorRow = ({
  colors,
  name,
  omit = ['modes'],
  render,
  size,
  ...props
}) => {
  return jsx("div", null, jsx("div", {
    sx: {
      display: 'flex',
      flexWrap: 'wrap'
    }
  }, Object.keys(colors).map(key => {
    const color = colors[key];
    if (!color || omit.includes(key)) return false;
    const id = join(name, key);

    if (typeof color === 'object') {
      return jsx(ColorRow, _extends({}, props, {
        key: key,
        name: id,
        colors: color,
        size: size,
        omit: omit
      }));
    }

    const swatch = jsx(ColorSwatch, _extends({}, props, {
      key: key,
      name: id,
      color: id,
      size: size,
      sx: {
        m: 2
      }
    }));

    if (typeof render === 'function') {
      return render({
        swatch,
        color,
        key,
        name: id
      });
    }

    return swatch;
  })));
};
const ColorPalette = ({
  omit,
  mode,
  ...props
}) => {
  const theme = useTheme();
  let colors = theme.colors;

  if (mode && colors.modes) {
    colors = colors.modes[mode] || colors;
  }

  return jsx("div", {
    style: {
      marginLeft: -8,
      marginRight: -8
    }
  }, jsx(ColorRow, _extends({}, props, {
    omit: omit,
    colors: colors
  })));
};

const ThemeCard = props => {
  return jsx(Card, _extends({}, props, {
    sx: {
      color: 'text',
      bg: 'background'
    }
  }), jsx(TypeStyle, null), jsx(ColorPalette, {
    label: false,
    size: 32
  }));
};

export { ColorPalette, ColorSwatch, FontFamily, HeadingStyle, ThemeCard, TypeScale, TypeStyle, useTheme };
